#define _POSIX_C_SOURCE 200809L
#include<stdio.h>
#include<stdlib.h>
#include<string.h>
#include<ctype.h>
#include<stdint.h>
#include<stdbool.h>
#include<stdarg.h>
#include<setjmp.h>
#include<pthread.h>
#include<sys/stat.h>
#include<fcntl.h>
#include<unistd.h>
#include<math.h>
#include<limits.h>
#include<errno.h>
typedef struct{uint64_t*d;uint32_t n,c;bool s;}U;typedef struct{U*n,*d;}R;
static U*un(uint32_t c){U*u=malloc(sizeof(U));u->d=calloc(c,8);u->n=0;u->c=c;u->s=0;return u;}
static void uf(U*u){if(u){free(u->d);free(u);}}
static void ug(U*u,uint32_t c){if(c>u->c){u->d=realloc(u->d,c*8);memset(u->d+u->c,0,(c-u->c)*8);u->c=c;}}
static void uz(U*u){while(u->n>0&&!u->d[u->n-1])u->n--;if(!u->n)u->s=0;}
static int uca(const U*a,const U*b){if(a->n!=b->n)return a->n>b->n?1:-1;for(int i=a->n-1;i>=0;i--)if(a->d[i]!=b->d[i])return a->d[i]>b->d[i]?1:-1;return 0;}
static int uc(const U*a,const U*b){if(a->s!=b->s)return a->s?-1:1;int c=uca(a,b);return a->s?-c:c;}
static inline uint64_t adc(uint64_t a,uint64_t b,uint64_t c,uint64_t*r){__uint128_t s=(__uint128_t)a+b+c;*r=s;return s>>64;}
static inline uint64_t sbb(uint64_t a,uint64_t b,uint64_t c,uint64_t*r){__uint128_t d=(__uint128_t)a-b-c;*r=d;return-(d>>64);}
static void uaa(U*r,const U*a,const U*b){uint32_t m=(a->n>b->n?a->n:b->n)+1;ug(r,m);uint64_t c=0;uint32_t i;for(i=0;i<a->n||i<b->n||c;i++){uint64_t ai=i<a->n?a->d[i]:0,bi=i<b->n?b->d[i]:0;c=adc(ai,bi,c,&r->d[i]);}r->n=i;uz(r);}
static void usa(U*r,const U*a,const U*b){ug(r,a->n);uint64_t c=0;for(uint32_t i=0;i<a->n;i++){uint64_t ai=a->d[i],bi=i<b->n?b->d[i]:0;c=sbb(ai,bi,c,&r->d[i]);}r->n=a->n;uz(r);}
static void ua(U*r,const U*a,const U*b){if(a->s==b->s){uaa(r,a,b);r->s=a->s;}else{int c=uca(a,b);if(c>=0){usa(r,a,b);r->s=a->s;}else{usa(r,b,a);r->s=b->s;}}}
static void us(U*r,const U*a,const U*b){U t=*b;t.s=!b->s;ua(r,a,&t);}
static void umb(U*r,const U*a,const U*b){ug(r,a->n+b->n);memset(r->d,0,(a->n+b->n)*8);for(uint32_t i=0;i<a->n;i++){uint64_t c=0;for(uint32_t j=0;j<b->n;j++){__uint128_t p=(__uint128_t)a->d[i]*b->d[j]+r->d[i+j]+c;r->d[i+j]=p;c=p>>64;}r->d[i+b->n]=c;}r->n=a->n+b->n;r->s=a->s!=b->s;uz(r);}
static void umk(U*r,const U*a,const U*b){uint32_t n=a->n>b->n?a->n:b->n;if(n<20){umb(r,a,b);return;}uint32_t m=n/2;U a0={a->d,a->n>m?m:a->n,a->c,0},a1={a->n>m?a->d+m:0,a->n>m?a->n-m:0,0,0};U b0={b->d,b->n>m?m:b->n,b->c,0},b1={b->n>m?b->d+m:0,b->n>m?b->n-m:0,0,0};U*z0=un(a0.n+b0.n),*z2=un(a1.n+b1.n),*z1=un(n*2);umk(z0,&a0,&b0);umk(z2,&a1,&b1);U*as=un(m+1),*bs=un(m+1);ua(as,&a0,&a1);ua(bs,&b0,&b1);umk(z1,as,bs);us(z1,z1,z0);us(z1,z1,z2);ug(r,2*n);memset(r->d,0,2*n*8);for(uint32_t i=0;i<z0->n;i++)r->d[i]=z0->d[i];uint64_t c=0;for(uint32_t i=0;i<z1->n||c;i++){uint64_t v=r->d[m+i]+(i<z1->n?z1->d[i]:0)+c;r->d[m+i]=v;c=v<r->d[m+i];}c=0;for(uint32_t i=0;i<z2->n||c;i++){uint64_t v=r->d[2*m+i]+(i<z2->n?z2->d[i]:0)+c;r->d[2*m+i]=v;c=v<r->d[2*m+i];}r->n=2*n;r->s=a->s!=b->s;uz(r);uf(z0);uf(z1);uf(z2);uf(as);uf(bs);}
static void um(U*r,const U*a,const U*b){umk(r,a,b);}
static void udm(U*q,U*r,const U*a,const U*b){int c=uca(a,b);if(c<0){if(q){q->n=0;q->s=0;}if(r){memcpy(r->d,a->d,a->n*8);r->n=a->n;r->s=a->s;}return;}if(b->n==1){uint64_t dv=b->d[0];if(q)ug(q,a->n);uint64_t rm=0;for(int i=a->n-1;i>=0;i--){__uint128_t dd=((__uint128_t)rm<<64)|a->d[i];if(q)q->d[i]=dd/dv;rm=dd%dv;}if(q){q->n=a->n;q->s=a->s!=b->s;uz(q);}if(r){r->d[0]=rm;r->n=rm?1:0;r->s=a->s&&rm;}return;}U*dv=un(a->n);memcpy(dv->d,a->d,a->n*8);dv->n=a->n;if(q){ug(q,a->n);memset(q->d,0,a->n*8);q->n=0;}U*o=un(1);o->d[0]=1;o->n=1;while(uca(dv,b)>=0){usa(dv,dv,b);if(q)ua(q,q,o);}if(q)q->s=a->s!=b->s;if(r){memcpy(r->d,dv->d,dv->n*8);r->n=dv->n;r->s=a->s&&dv->n;}uf(dv);uf(o);}
static void ush(U*r,const U*a,uint32_t b){ug(r,a->n+(b+63)/64);uint32_t wsh=b/64,bsh=b%64;if(!bsh){for(uint32_t i=0;i<wsh;i++)r->d[i]=0;for(uint32_t i=0;i<a->n;i++)r->d[i+wsh]=a->d[i];}else{r->d[0]=0;for(uint32_t i=0;i<a->n;i++){r->d[i+wsh]|=a->d[i]<<bsh;r->d[i+wsh+1]=a->d[i]>>(64-bsh);}if(!r->d[a->n+wsh])r->n=a->n+wsh;else r->n=a->n+wsh+1;}r->s=a->s;uz(r);}
static void upw(U*r,const U*a,uint64_t e){if(!e){r->d[0]=1;r->n=1;r->s=0;return;}U*t=un(8),*p=un(8);memcpy(p->d,a->d,a->n*8);p->n=a->n;p->s=a->s;t->d[0]=1;t->n=1;while(e){if(e&1){U*m=un(t->n+p->n);um(m,t,p);uf(t);t=m;}if(e>1){U*sq=un(p->n*2);um(sq,p,p);uf(p);p=sq;}e>>=1;}memcpy(r->d,t->d,t->n*8);r->n=t->n;r->s=t->s;uf(t);uf(p);}
static U*ufd(const char*s){U*r=un(4),*ten=un(1);ten->d[0]=10;ten->n=1;bool neg=*s=='-';if(neg||*s=='+')s++;while(*s){if(*s>='0'&&*s<='9'){U*d=un(1);d->d[0]=*s-'0';d->n=1;U*t=un(r->n*2);um(t,r,ten);uf(r);r=t;t=un(r->n+1);ua(t,r,d);uf(r);uf(d);r=t;}s++;}r->s=neg;uf(ten);return r;}
static char*utd(const U*u){if(!u->n){char*s=malloc(2);strcpy(s,"0");return s;}char*res=malloc(u->n*20+2);int p=0;U*t=un(u->n);memcpy(t->d,u->d,u->n*8);t->n=u->n;U*ten=un(1);ten->d[0]=10;ten->n=1;U*rm=un(1);while(t->n){udm(t,rm,t,ten);res[p++]='0'+(rm->n?rm->d[0]:0);}if(u->s)res[p++]='-';res[p]=0;for(int i=0;i<p/2;i++){char c=res[i];res[i]=res[p-1-i];res[p-1-i]=c;}uf(t);uf(ten);uf(rm);return res;}
static void ugcd(U*r,const U*a,const U*b){U*x=un(a->n>b->n?a->n:b->n),*y=un(a->n>b->n?a->n:b->n);memcpy(x->d,a->d,a->n*8);x->n=a->n;x->s=0;memcpy(y->d,b->d,b->n*8);y->n=b->n;y->s=0;uint32_t sh=0;while(x->n&&y->n&&!(x->d[0]&1)&&!(y->d[0]&1)){for(uint32_t i=0;i<x->n-1;i++)x->d[i]=(x->d[i]>>1)|(x->d[i+1]<<63);x->d[x->n-1]>>=1;uz(x);for(uint32_t i=0;i<y->n-1;i++)y->d[i]=(y->d[i]>>1)|(y->d[i+1]<<63);y->d[y->n-1]>>=1;uz(y);sh++;}while(x->n){while(x->n&&!(x->d[0]&1)){for(uint32_t i=0;i<x->n-1;i++)x->d[i]=(x->d[i]>>1)|(x->d[i+1]<<63);x->d[x->n-1]>>=1;uz(x);}while(y->n&&!(y->d[0]&1)){for(uint32_t i=0;i<y->n-1;i++)y->d[i]=(y->d[i]>>1)|(y->d[i+1]<<63);y->d[y->n-1]>>=1;uz(y);}if(uca(x,y)>=0)usa(x,x,y);else usa(y,y,x);}memcpy(r->d,y->d,y->n*8);r->n=y->n;r->s=0;U*t=un(r->n+sh/64+1);ush(t,r,sh);memcpy(r->d,t->d,t->n*8);r->n=t->n;uf(x);uf(y);uf(t);}
static void rn(R*r){U*g=un(8);ugcd(g,r->n,r->d);if(g->n&&!(g->n==1&&g->d[0]==1)){U*nn=un(r->n->n),*nd=un(r->d->n);udm(nn,0,r->n,g);udm(nd,0,r->d,g);uf(r->n);uf(r->d);r->n=nn;r->d=nd;}if(r->d->s){r->n->s=!r->n->s;r->d->s=0;}uf(g);}
static void ra(R*r,const R*a,const R*b){U*ad=un(16),*bd=un(16),*nn=un(16),*nd=un(16);um(ad,a->n,b->d);um(bd,b->n,a->d);ua(nn,ad,bd);um(nd,a->d,b->d);r->n=nn;r->d=nd;rn(r);uf(ad);uf(bd);}
static void rm(R*r,const R*a,const R*b){r->n=un(a->n->n+b->n->n);r->d=un(a->d->n+b->d->n);um(r->n,a->n,b->n);um(r->d,a->d,b->d);rn(r);}
static double rtd(const R*u){char*ns=utd(u->n),*ds=utd(u->d);double n=strtod(ns,0),d=strtod(ds,0);free(ns);free(ds);return n/d;}
typedef struct{char*b,*p,*e;}A;typedef struct{const char*s;uint32_t n;}S;typedef struct{uint32_t l,c;const char*f;}L;
#define Z(x)((S){x,sizeof(x)-1})
#define N ((S){0,0})
static A M={0};static int E=0;
static void*al(size_t n){n=(n+7)&~7;if(!M.b||M.p+n>M.e){size_t z=1<<24;M.b=M.p=malloc(z);M.e=M.b+z;}void*r=M.p;M.p+=n;return memset(r,0,n);}
static void ar(){if(M.b)M.p=M.b;}
static S sd(S s){char*p=al(s.n+1);memcpy(p,s.s,s.n);return(S){p,s.n};}
static bool se(S a,S b){return a.n==b.n&&!memcmp(a.s,b.s,a.n);}
static bool si(S a,S b){if(a.n!=b.n)return 0;for(uint32_t i=0;i<a.n;i++)if(tolower(a.s[i])!=tolower(b.s[i]))return 0;return 1;}
static char*LC(S s){static char b[8][256];static int i;char*p=b[i++&7];uint32_t n=s.n<255?s.n:255;for(uint32_t j=0;j<n;j++)p[j]=tolower(s.s[j]);p[n]=0;return p;}
static uint64_t sh(S s){uint64_t h=14695981039346656037ULL;for(uint32_t i=0;i<s.n;i++)h=(h^(uint8_t)tolower(s.s[i]))*1099511628211ULL;return h;}
static _Noreturn void die(L l,const char*f,...){va_list v;va_start(v,f);fprintf(stderr,"%s:%u:%u: ",l.f,l.l,l.c);vfprintf(stderr,f,v);fputc('\n',stderr);va_end(v);E++;exit(1);}
typedef enum{T_EOF=0,T_ERR,T_ID,T_INT,T_REAL,T_CHAR,T_STR,T_LP,T_RP,T_LB,T_RB,T_CM,T_DT,T_SC,T_CL,T_TK,T_AS,T_AR,T_DD,T_LL,T_GG,T_BX,T_BR,T_EQ,T_NE,T_LT,T_LE,T_GT,T_GE,T_PL,T_MN,T_ST,T_SL,T_AM,T_EX,T_AB,T_ABS,T_ACC,T_ACCS,T_ALITK,T_ALL,T_AND,T_ATHN,T_ARR,T_AT,T_BEG,T_BOD,T_CSE,T_CONST,T_DEC,T_DEL,T_DELTA,T_DIG,T_DO,T_ELSE,T_ELSIF,T_END,T_ENT,T_EXCP,T_EXIT,T_FOR,T_FUN,T_GEN,T_GOTO,T_IF,T_IN,T_IS,T_LIM,T_LOOP,T_MOD,T_NEW,T_NOT,T_NULL,T_OF,T_OR,T_OREL,T_OTH,T_OUT,T_PKG,T_PGM,T_PRV,T_PROC,T_RAS,T_RNG,T_REC,T_REM,T_REN,T_RET,T_REV,T_SEL,T_SEP,T_SUB,T_TSK,T_TER,T_THEN,T_TYP,T_USE,T_WHN,T_WHI,T_WITH,T_XOR,T_CNT}Tk;
enum{CHK_OVF=1,CHK_RNG=2,CHK_IDX=4,CHK_DSC=8,CHK_LEN=16,CHK_DIV=32,CHK_ELB=64,CHK_ACC=128,CHK_STG=256};
static const char*TN[T_CNT]={[T_EOF]="eof",[T_ERR]="ERR",[T_ID]="id",[T_INT]="int",[T_REAL]="real",[T_CHAR]="char",[T_STR]="str",[T_LP]="(",[T_RP]=")",[T_LB]="[",[T_RB]="]",[T_CM]=",",[T_DT]=".",[T_SC]=";",[T_CL]=":",[T_TK]="'",[T_AS]=":=",[T_AR]="=>",[T_DD]="..",[T_LL]="<<",[T_GG]=">>",[T_BX]="<>",[T_BR]="|",[T_EQ]="=",[T_NE]="/=",[T_LT]="<",[T_LE]="<=",[T_GT]=">",[T_GE]=">=",[T_PL]="+",[T_MN]="-",[T_ST]="*",[T_SL]="/",[T_AM]="&",[T_EX]="**",[T_AB]="ABORT",[T_ABS]="ABS",[T_ACC]="ACCEPT",[T_ACCS]="ACCESS",[T_ALITK]="ALIASED",[T_ALL]="ALL",[T_AND]="AND",[T_ATHN]="AND THEN",[T_ARR]="ARRAY",[T_AT]="AT",[T_BEG]="BEGIN",[T_BOD]="BODY",[T_CSE]="CASE",[T_CONST]="CONSTANT",[T_DEC]="DECLARE",[T_DEL]="DELAY",[T_DELTA]="DELTA",[T_DIG]="DIGITS",[T_DO]="DO",[T_ELSE]="ELSE",[T_ELSIF]="ELSIF",[T_END]="END",[T_ENT]="ENTRY",[T_EXCP]="EXCEPTION",[T_EXIT]="EXIT",[T_FOR]="FOR",[T_FUN]="FUNCTION",[T_GEN]="GENERIC",[T_GOTO]="GOTO",[T_IF]="IF",[T_IN]="IN",[T_IS]="IS",[T_LIM]="LIMITED",[T_LOOP]="LOOP",[T_MOD]="MOD",[T_NEW]="NEW",[T_NOT]="NOT",[T_NULL]="NULL",[T_OF]="OF",[T_OR]="OR",[T_OREL]="OR ELSE",[T_OTH]="OTHERS",[T_OUT]="OUT",[T_PKG]="PACKAGE",[T_PGM]="PRAGMA",[T_PRV]="PRIVATE",[T_PROC]="PROCEDURE",[T_RAS]="RAISE",[T_RNG]="RANGE",[T_REC]="RECORD",[T_REM]="REM",[T_REN]="RENAMES",[T_RET]="RETURN",[T_REV]="REVERSE",[T_SEL]="SELECT",[T_SEP]="SEPARATE",[T_SUB]="SUBTYPE",[T_TSK]="TASK",[T_TER]="TERMINATE",[T_THEN]="THEN",[T_TYP]="TYPE",[T_USE]="USE",[T_WHN]="WHEN",[T_WHI]="WHILE",[T_WITH]="WITH",[T_XOR]="XOR"};
typedef struct{Tk t;L l;S lit;int64_t iv;double fv;U*ui;R*ur;}Tn;typedef struct{const char*s,*c,*e;uint32_t ln,cl;const char*f;}Lx;
static struct{S k;Tk t;}KW[]={{Z("abort"),T_AB},{Z("abs"),T_ABS},{Z("accept"),T_ACC},{Z("access"),T_ACCS},{Z("all"),T_ALL},{Z("and"),T_AND},{Z("array"),T_ARR},{Z("at"),T_AT},{Z("begin"),T_BEG},{Z("body"),T_BOD},{Z("case"),T_CSE},{Z("constant"),T_CONST},{Z("declare"),T_DEC},{Z("delay"),T_DEL},{Z("delta"),T_DELTA},{Z("digits"),T_DIG},{Z("do"),T_DO},{Z("else"),T_ELSE},{Z("elsif"),T_ELSIF},{Z("end"),T_END},{Z("entry"),T_ENT},{Z("exception"),T_EXCP},{Z("exit"),T_EXIT},{Z("for"),T_FOR},{Z("function"),T_FUN},{Z("generic"),T_GEN},{Z("goto"),T_GOTO},{Z("if"),T_IF},{Z("in"),T_IN},{Z("is"),T_IS},{Z("limited"),T_LIM},{Z("loop"),T_LOOP},{Z("mod"),T_MOD},{Z("new"),T_NEW},{Z("not"),T_NOT},{Z("null"),T_NULL},{Z("of"),T_OF},{Z("or"),T_OR},{Z("others"),T_OTH},{Z("out"),T_OUT},{Z("package"),T_PKG},{Z("pragma"),T_PGM},{Z("private"),T_PRV},{Z("procedure"),T_PROC},{Z("raise"),T_RAS},{Z("range"),T_RNG},{Z("record"),T_REC},{Z("rem"),T_REM},{Z("renames"),T_REN},{Z("return"),T_RET},{Z("reverse"),T_REV},{Z("select"),T_SEL},{Z("separate"),T_SEP},{Z("subtype"),T_SUB},{Z("task"),T_TSK},{Z("terminate"),T_TER},{Z("then"),T_THEN},{Z("type"),T_TYP},{Z("use"),T_USE},{Z("when"),T_WHN},{Z("while"),T_WHI},{Z("with"),T_WITH},{Z("xor"),T_XOR},{N,T_EOF}};
static Tk kl(S s){for(int i=0;KW[i].k.s;i++)if(si(s,KW[i].k))return KW[i].t;return T_ID;}
static Lx ln(const char*s,size_t z,const char*f){return(Lx){s,s,s+z,1,1,f};}
static char pk(Lx*l){return l->c<l->e?*l->c:0;}
static char p2(Lx*l){return l->c+1<l->e?l->c[1]:0;}
static char p3(Lx*l){return l->c+2<l->e?l->c[2]:0;}
static char av(Lx*l){if(l->c>=l->e)return 0;char c=*l->c++;if(c=='\n'){l->ln++;l->cl=1;}else l->cl++;return c;}
static void sw(Lx*l){for(;;){while(l->c<l->e&&(*l->c==' '||*l->c=='\t'||*l->c=='\n'||*l->c=='\r'))av(l);if(l->c+1<l->e&&l->c[0]=='-'&&l->c[1]=='-'){while(l->c<l->e&&*l->c!='\n')av(l);}else break;}}
static Tn mt(Tk t,L lc,S lt){return(Tn){t,lc,lt,0,0.0};}
static Tn si_(Lx*l){L lc={l->ln,l->cl,l->f};const char*s=l->c;while(isalnum(pk(l))||pk(l)=='_')av(l);S lt={s,l->c-s};Tk t=kl(lt);if(t!=T_ID&&l->c<l->e&&(isalnum(*l->c)||*l->c=='_'))return mt(T_ERR,lc,Z("kw+x"));return mt(t,lc,lt);}
static Tn sn(Lx*l){L lc={l->ln,l->cl,l->f};const char*s=l->c;const char*ms=0,*me=0,*es=0;int b=10;bool ir=false,bx=false;char bd=0;while(isdigit(pk(l))||pk(l)=='_')av(l);if(pk(l)=='#'||(pk(l)==':'&&isxdigit(p2(l)))){bd=pk(l);const char*be=l->c;av(l);char*bp=al(32);int bi=0;for(const char*p=s;p<be;p++)if(*p!='_')bp[bi++]=*p;bp[bi]=0;b=atoi(bp);ms=l->c;while(isxdigit(pk(l))||pk(l)=='_')av(l);if(pk(l)=='.'){ir=true;av(l);while(isxdigit(pk(l))||pk(l)=='_')av(l);}if(pk(l)==bd){me=l->c;av(l);}if(tolower(pk(l))=='e'){bx=true;av(l);if(pk(l)=='+'||pk(l)=='-')av(l);es=l->c;while(isdigit(pk(l))||pk(l)=='_')av(l);}}else{if(pk(l)=='.'){if(p2(l)!='.'&&!isalpha(p2(l))){ir=true;av(l);while(isdigit(pk(l))||pk(l)=='_')av(l);}}if(tolower(pk(l))=='e'){ir=true;av(l);if(pk(l)=='+'||pk(l)=='-')av(l);while(isdigit(pk(l))||pk(l)=='_')av(l);}}if(isalpha(pk(l)))return mt(T_ERR,lc,Z("num+alpha"));Tn tk=mt(bx?(ir?T_REAL:T_INT):(ir?T_REAL:T_INT),lc,(S){s,l->c-s});if(bx&&es){char*mp=al(512);char*ep=al(512);int mi=0,ei=0;for(const char*p=ms;p<me;p++)if(*p!='_'&&*p!=bd)mp[mi++]=*p;mp[mi]=0;for(const char*p=es;p<l->c;p++)if(*p!='_')ep[ei++]=*p;ep[ei]=0;double m=0;int dp=-1;for(int i=0;i<mi;i++){if(mp[i]=='.'){dp=i;break;}}int fp=0;for(int i=0;i<mi;i++){if(mp[i]=='.')continue;int dv=mp[i]>='A'&&mp[i]<='F'?mp[i]-'A'+10:mp[i]>='a'&&mp[i]<='f'?mp[i]-'a'+10:mp[i]-'0';if(dp<0||i<dp)m=m*b+dv;else{fp++;m+=dv/pow(b,fp);}}int ex=atoi(ep);double rv=m*pow(b,ex);if(ir)tk.fv=rv;else{if(rv>LLONG_MAX||rv<LLONG_MIN){fprintf(stderr,"Error %d:%d: based integer constant out of range: %.*s\n",lc.l,lc.c,(int)(l->c-s),s);exit(1);}tk.iv=(int64_t)rv;}}else{char*tp=al(512);int j=0;const char*start=(bd&&ms)?ms:s;const char*end=(bd&&me)?me:l->c;for(const char*p=start;p<end;p++)if(*p!='_'&&*p!='#'&&*p!=':')tp[j++]=*p;tp[j]=0;if(bd&&!ir){int64_t v=0;for(int i=0;i<j;i++){int dv=tp[i]>='A'&&tp[i]<='F'?tp[i]-'A'+10:tp[i]>='a'&&tp[i]<='f'?tp[i]-'a'+10:tp[i]-'0';v=v*b+dv;}tk.iv=v;}else if(bd&&ir){double m=0;int dp=-1;for(int i=0;i<j;i++){if(tp[i]=='.'){dp=i;break;}}int fp=0;for(int i=0;i<j;i++){if(tp[i]=='.')continue;int dv=tp[i]>='A'&&tp[i]<='F'?tp[i]-'A'+10:tp[i]>='a'&&tp[i]<='f'?tp[i]-'a'+10:tp[i]-'0';if(dp<0||i<dp)m=m*b+dv;else{fp++;m+=dv/pow(b,fp);}}tk.fv=m;}else{if(ir)errno=0;tk.fv=strtod(tp,0);if(errno==ERANGE&&(tk.fv==HUGE_VAL||tk.fv==-HUGE_VAL)){fprintf(stderr,"Warning %d:%d: float constant overflow to infinity: %s\n",lc.l,lc.c,tp);}else tk.ui=ufd(tp);tk.iv=(tk.ui->n==1)?tk.ui->d[0]:0;if(tk.ui&&tk.ui->n>1&&!ir){fprintf(stderr,"Error %d:%d: integer constant too large for i64: %s\n",lc.l,lc.c,tp);}}}return tk;}
static Tn sc(Lx*l){L lc={l->ln,l->cl,l->f};av(l);if(!pk(l))return mt(T_ERR,lc,Z("uc"));char c=pk(l);av(l);if(pk(l)!='\'')return mt(T_ERR,lc,Z("uc"));av(l);Tn tk=mt(T_CHAR,lc,(S){&c,1});tk.iv=c;return tk;}
static Tn ss(Lx*l){L lc={l->ln,l->cl,l->f};char d=pk(l);av(l);const char*s=l->c;char*b=al(256),*p=b;int n=0;while(pk(l)){if(pk(l)==d){if(p2(l)==d){av(l);av(l);if(n<255)*p++=d;n++;}else break;}else{if(n<255)*p++=pk(l);n++;av(l);}}if(pk(l)==d)av(l);else return mt(T_ERR,lc,Z("us"));*p=0;S lt={b,n};return mt(T_STR,lc,lt);}
static Tn lnx(Lx*l){sw(l);L lc={l->ln,l->cl,l->f};char c=pk(l);if(!c)return mt(T_EOF,lc,N);if(isalpha(c))return si_(l);if(isdigit(c))return sn(l);if(c=='\''){char c2=p2(l);char pc=l->c>l->s?l->c[-1]:0;if(c2&&p3(l)=='\''&&(l->c+3>=l->e||l->c[3]!='\'')&&!isalnum(pc)&&pc!='_')return sc(l);av(l);return mt(T_TK,lc,Z("'"));}if(c=='"'||c=='%')return ss(l);av(l);switch(c){case'(':return mt(T_LP,lc,Z("("));case')':return mt(T_RP,lc,Z(")"));case'[':return mt(T_LB,lc,Z("["));case']':return mt(T_RB,lc,Z("]"));case',':return mt(T_CM,lc,Z(","));case';':return mt(T_SC,lc,Z(";"));case'&':return mt(T_AM,lc,Z("&"));case'|':return mt(T_BR,lc,Z("|"));case'+':return mt(T_PL,lc,Z("+"));case'-':return mt(T_MN,lc,Z("-"));case'/':if(pk(l)=='='){av(l);return mt(T_NE,lc,Z("/="));}return mt(T_SL,lc,Z("/"));case'*':if(pk(l)=='*'){av(l);return mt(T_EX,lc,Z("**"));}return mt(T_ST,lc,Z("*"));case'=':if(pk(l)=='>'){av(l);return mt(T_AR,lc,Z("=>"));}return mt(T_EQ,lc,Z("="));case':':if(pk(l)=='='){av(l);return mt(T_AS,lc,Z(":="));}return mt(T_CL,lc,Z(":"));case'.':if(pk(l)=='.'){av(l);return mt(T_DD,lc,Z(".."));}return mt(T_DT,lc,Z("."));case'<':if(pk(l)=='='){av(l);return mt(T_LE,lc,Z("<="));}if(pk(l)=='<'){av(l);return mt(T_LL,lc,Z("<<"));}if(pk(l)=='>'){av(l);return mt(T_BX,lc,Z("<>"));}return mt(T_LT,lc,Z("<"));case'>':if(pk(l)=='='){av(l);return mt(T_GE,lc,Z(">="));}if(pk(l)=='>'){av(l);return mt(T_GG,lc,Z(">>"));}return mt(T_GT,lc,Z(">"));}return mt(T_ERR,lc,Z("ux"));}
typedef enum{N_ERR=0,N_ID,N_INT,N_REAL,N_CHAR,N_STR,N_NULL,N_AG,N_BIN,N_UN,N_AT,N_QL,N_CL,N_IX,N_SL,N_SEL,N_ALC,N_TI,N_TE,N_TF,N_TX,N_TA,N_TR,N_TAC,N_TP,N_ST,N_RN,N_CN,N_CM,N_VR,N_VP,N_DS,N_PM,N_PS,N_FS,N_PB,N_FB,N_PD,N_FD,N_PKS,N_PKB,N_PKD,N_OD,N_ND,N_TD,N_SD,N_ED,N_RE,N_AS,N_IF,N_CS,N_LP,N_BL,N_EX,N_RT,N_GT,N_RS,N_NS,N_CLT,N_EC,N_DL,N_AB,N_CD,N_ACC,N_SLS,N_SA,N_TKS,N_TKB,N_TKD,N_ENT,N_EI,N_HD,N_CH,N_ASC,N_WH,N_EL,N_WI,N_US,N_PG,N_RP,N_GD,N_GI,N_GF,N_CU,N_CX,N_LST,N_DRF,N_CVT,N_CHK,N_RRC,N_ERC,N_LNC,N_ADC,N_ALC2,N_DRV,N_LBL,N_OPID,N_GTP,N_GVL,N_GSP,N_GEN,N_GINST,N_TRM,N_CNT}Nk;
typedef struct Ty Ty;typedef struct No No;typedef struct Sy Sy;typedef struct RC RC;typedef struct LU LU;typedef struct GT GT;typedef struct{No**d;uint32_t n,c;}NV;typedef struct{Sy**d;uint32_t n,c;}SV;typedef struct{RC**d;uint32_t n,c;}RV;typedef struct{LU**d;uint32_t n,c;}LV;typedef struct{GT**d;uint32_t n,c;}GV;typedef struct{FILE**d;uint32_t n,c;}FV;typedef struct{S*d;uint32_t n,c;}SLV;
static void nv(NV*v,No*n){if(v->n>=v->c){v->c=v->c?v->c<<1:8;v->d=realloc(v->d,v->c*sizeof(No*));}v->d[v->n++]=n;}
static void sv(SV*v,Sy*s){if(v->n>=v->c){v->c=v->c?v->c<<1:8;v->d=realloc(v->d,v->c*sizeof(Sy*));}v->d[v->n++]=s;}
static void rv(RV*v,RC*r){if(v->n>=v->c){v->c=v->c?v->c<<1:8;v->d=realloc(v->d,v->c*sizeof(RC*));}v->d[v->n++]=r;}
static void lv(LV*v,LU*l){if(v->n>=v->c){v->c=v->c?v->c<<1:8;v->d=realloc(v->d,v->c*sizeof(LU*));}v->d[v->n++]=l;}
static void gv(GV*v,GT*g){if(v->n>=v->c){v->c=v->c?v->c<<1:8;v->d=realloc(v->d,v->c*sizeof(GT*));}v->d[v->n++]=g;}
static void fv(FV*v,FILE*f){if(v->n>=v->c){v->c=v->c?v->c<<1:8;v->d=realloc(v->d,v->c*sizeof(FILE*));}v->d[v->n++]=f;}
static void slv(SLV*v,S s){if(v->n>=v->c){v->c=v->c?v->c<<1:8;v->d=realloc(v->d,v->c*sizeof(S));}v->d[v->n++]=s;}
struct No{Nk k;L l;Ty*ty;Sy*sy;union{S s;int64_t i;double f;struct{Tk op;No*l,*r;}bn;struct{Tk op;No*x;}un;struct{No*p;S at;NV ar;}at;struct{No*nm,*ag;}ql;struct{No*fn;NV ar;}cl;struct{No*p;NV ix;}ix;struct{No*p;No*lo,*hi;}sl;struct{No*p;S se;}se;struct{No*st;No*in;}alc;struct{No*lo,*hi;}rn;struct{No*rn;NV cs;}cn;struct{S nm;No*ty;No*in;bool al;uint32_t of,bt;No*dc;No*dsc;}cm;struct{NV ch;NV cmm;}vr;struct{No*ds;NV vrr;uint32_t sz;}vp;struct{S nm;No*ty;No*df;uint8_t md;}pm;struct{S nm;NV pmm;No*rt;S op;}sp;struct{No*sp;NV dc;NV st;NV hdd;int el;Sy*pr;NV lk;}bd;struct{S nm;NV dc;NV pr;int el;}ps;struct{S nm;NV dc;NV st;NV hddd;int el;}pb;struct{NV id;No*ty;No*in;bool co;}od;struct{S nm;No*df;No*ds;bool nw;bool drv;No*prt;NV dsc;}td;struct{S nm;No*in;No*cn;No*rn;}sd;struct{NV id;}ed;struct{S nm;No*rn;}re;struct{No*tg;No*vl;}as;struct{No*cd;NV th;NV ei;NV el;}if_;struct{No*ex;NV al;}cs;struct{S lb;No*it;bool rv;NV st;NV lk;}lp;struct{S lb;NV dc;NV st;NV hd;}bk;struct{S lb;No*cd;}ex;struct{No*vl;}rt;struct{S lb;}go;struct{No*ec;}rs;struct{No*nm;NV arr;}ct;struct{S nm;NV ixx;NV pmx;NV stx;NV hdx;No*gd;}acc;struct{NV al;NV el;}ss;struct{uint8_t kn;No*gd;NV sts;}sa;struct{S nm;NV en;bool it;}ts;struct{S nm;NV dc;NV st;NV hdz;}tb;struct{S nm;NV ixy;NV pmy;No*gd;}ent;struct{NV ec;NV stz;}hnd;struct{NV it;}ch;struct{NV ch;No*vl;}asc;struct{NV it;}lst;struct{NV wt;NV us;}cx;struct{S nm;}wt;struct{No*nm;}us;struct{S nm;NV ar;}pg;struct{No*cx;NV un;}cu;struct{No*x;}drf;struct{No*ty,*ex;}cvt;struct{No*ex;S ec;}chk;struct{No*bs;NV ops;}drv;struct{NV fp;NV dc;No*un;}gen;struct{S gn;NV ap;}gi;struct{NV it;No*lo,*hi;uint8_t dim;}ag;};};
struct RC{uint8_t k;Ty*ty;union{struct{S nm;uint32_t po;}er;struct{S nm;uint64_t ad;}ad;struct{S nm;NV cp;}rr;struct{S lang;S nm;S ext;}im;};};
struct LU{uint8_t k;S nm;S pth;No*sp;No*bd;LV wth;LV elb;uint64_t ts;bool cmpl;};
struct GT{S nm;NV fp;NV dc;No*un;};
static No*nd(Nk k,L l){No*n=al(sizeof(No));n->k=k;n->l=l;return n;}
static RC*rc(uint8_t k,Ty*t){RC*r=al(sizeof(RC));r->k=k;r->ty=t;return r;}
static LU*lu(uint8_t k,S nm,S pth){LU*l=al(sizeof(LU));l->k=k;l->nm=nm;l->pth=pth;return l;}
static GT*gt(S nm){GT*g=al(sizeof(GT));g->nm=nm;return g;}
#define ND(k,l)nd(N_##k,l)
typedef struct{Lx lx;Tn cr,pk;int er;SLV lb;}Ps;
static void pn(Ps*p){p->cr=p->pk;p->pk=lnx(&p->lx);if(p->cr.t==T_AND&&p->pk.t==T_THEN){p->cr.t=T_ATHN;p->pk=lnx(&p->lx);}if(p->cr.t==T_OR&&p->pk.t==T_ELSE){p->cr.t=T_OREL;p->pk=lnx(&p->lx);}}
static bool pa(Ps*p,Tk t){return p->cr.t==t;}
static bool pm(Ps*p,Tk t){if(pa(p,t)){pn(p);return 1;}return 0;}
static void pe(Ps*p,Tk t){if(!pm(p,t))die(p->cr.l,"exp '%s' got '%s'",TN[t],TN[p->cr.t]);}
static L pl(Ps*p){return p->cr.l;}
static S pi(Ps*p){S s=p->cr.lit;pe(p,T_ID);return s;}
static S pat(Ps*p){S s;if(pa(p,T_ID))s=pi(p);else if(pa(p,T_RNG)){s=Z("RANGE");pn(p);}else if(pa(p,T_ACCS)){s=Z("ACCESS");pn(p);}else if(pa(p,T_DIG)){s=Z("DIGITS");pn(p);}else if(pa(p,T_DELTA)){s=Z("DELTA");pn(p);}else if(pa(p,T_MOD)){s=Z("MOD");pn(p);}else if(pa(p,T_REM)){s=Z("REM");pn(p);}else if(pa(p,T_ABS)){s=Z("ABS");pn(p);}else if(pa(p,T_NOT)){s=Z("NOT");pn(p);}else if(pa(p,T_AND)){s=Z("AND");pn(p);}else if(pa(p,T_OR)){s=Z("OR");pn(p);}else if(pa(p,T_XOR)){s=Z("XOR");pn(p);}else if(pa(p,T_PL)){s=Z("+");pn(p);}else if(pa(p,T_MN)){s=Z("-");pn(p);}else if(pa(p,T_ST)){s=Z("*");pn(p);}else if(pa(p,T_SL)){s=Z("/");pn(p);}else if(pa(p,T_EQ)){s=Z("=");pn(p);}else if(pa(p,T_NE)){s=Z("/=");pn(p);}else if(pa(p,T_LT)){s=Z("<");pn(p);}else if(pa(p,T_LE)){s=Z("<=");pn(p);}else if(pa(p,T_GT)){s=Z(">");pn(p);}else if(pa(p,T_GE)){s=Z(">=");pn(p);}else if(pa(p,T_AM)){s=Z("&");pn(p);}else if(pa(p,T_EX)){s=Z("**");pn(p);}else die(pl(p),"exp attr");return s;}
static No*pnm(Ps*p);static No*pex(Ps*p);static No*ppr(Ps*p);static No*prn(Ps*p);static NV pst(Ps*p);static NV pdc(Ps*p);static NV phd(Ps*p);static No*ps(Ps*p);static No*pgf(Ps*p);static RC*prc(Ps*p);
static No*ppr(Ps*p){L lc=pl(p);if(pm(p,T_LP)){NV v={0};do{NV ch={0};No*e=pex(p);nv(&ch,e);while(pm(p,T_BR))nv(&ch,pex(p));if(pa(p,T_AR)){pn(p);No*vl=pex(p);for(uint32_t i=0;i<ch.n;i++){No*a=ND(ASC,lc);nv(&a->asc.ch,ch.d[i]);a->asc.vl=vl;nv(&v,a);}}else if(ch.n==1&&ch.d[0]->k==N_ID&&pm(p,T_RNG)){No*rng=prn(p);pe(p,T_AR);No*vl=pex(p);No*si=ND(ST,lc);No*cn=ND(CN,lc);cn->cn.rn=rng;si->sd.in=ch.d[0];si->sd.cn=cn;No*a=ND(ASC,lc);nv(&a->asc.ch,si);a->asc.vl=vl;nv(&v,a);}else{if(ch.n==1)nv(&v,ch.d[0]);else die(lc,"exp '=>'");}}while(pm(p,T_CM));pe(p,T_RP);if(v.n==1&&v.d[0]->k!=N_ASC)return v.d[0];No*n=ND(AG,lc);n->ag.it=v;return n;}if(pm(p,T_NEW)){No*n=ND(ALC,lc);n->alc.st=pnm(p);if(pm(p,T_TK)){pe(p,T_LP);n->alc.in=pex(p);pe(p,T_RP);}return n;}if(pm(p,T_NULL))return ND(NULL,lc);if(pm(p,T_OTH)){No*n=ND(ID,lc);n->s=Z("others");return n;}if(pa(p,T_INT)){No*n=ND(INT,lc);n->i=p->cr.iv;pn(p);return n;}if(pa(p,T_REAL)){No*n=ND(REAL,lc);n->f=p->cr.fv;pn(p);return n;}if(pa(p,T_CHAR)){No*n=ND(CHAR,lc);n->i=p->cr.iv;pn(p);return n;}if(pa(p,T_STR)){No*n=ND(STR,lc);n->s=sd(p->cr.lit);pn(p);for(;;){if(pa(p,T_LP)){pn(p);NV v={0};do{NV ch={0};No*e=pex(p);if(e->k==N_ID&&pa(p,T_AR)){pn(p);No*a=ND(ASC,lc);nv(&a->asc.ch,e);a->asc.vl=pex(p);nv(&v,a);}else{nv(&ch,e);while(pm(p,T_BR))nv(&ch,pex(p));if(pa(p,T_AR)){pn(p);No*vl=pex(p);for(uint32_t i=0;i<ch.n;i++){No*a=ND(ASC,lc);nv(&a->asc.ch,ch.d[i]);a->asc.vl=vl;nv(&v,a);}}else{if(ch.n==1)nv(&v,ch.d[0]);else die(lc,"exp '=>'");}}}while(pm(p,T_CM));pe(p,T_RP);No*m=ND(CL,lc);m->cl.fn=n;m->cl.ar=v;n=m;}else break;}return n;}if(pa(p,T_ID))return pnm(p);if(pm(p,T_NOT)){No*n=ND(UN,lc);n->un.op=T_NOT;n->un.x=ppr(p);return n;}if(pm(p,T_ABS)){No*n=ND(UN,lc);n->un.op=T_ABS;n->un.x=ppr(p);return n;}if(pm(p,T_ALL)){No*n=ND(DRF,lc);n->drf.x=ppr(p);return n;}die(lc,"exp expr");}
static No*pnm(Ps*p){L lc=pl(p);No*n=ND(ID,lc);n->s=pi(p);for(;;){if(pm(p,T_DT)){if(pm(p,T_ALL)){No*m=ND(DRF,lc);m->drf.x=n;n=m;}else{No*m=ND(SEL,lc);m->se.p=n;if(pa(p,T_STR)){m->se.se=p->cr.lit;pn(p);}else m->se.se=pi(p);n=m;}}else if(pm(p,T_TK)){if(pa(p,T_LP)){pn(p);No*m=ND(QL,lc);m->ql.nm=n;NV v={0};do{NV ch={0};No*e=pex(p);nv(&ch,e);while(pm(p,T_BR))nv(&ch,pex(p));if(pa(p,T_AR)){pn(p);No*vl=pex(p);for(uint32_t i=0;i<ch.n;i++){No*a=ND(ASC,lc);nv(&a->asc.ch,ch.d[i]);a->asc.vl=vl;nv(&v,a);}}else{if(ch.n==1)nv(&v,ch.d[0]);else die(lc,"exp '=>'");}}while(pm(p,T_CM));pe(p,T_RP);if(v.n==1&&v.d[0]->k!=N_ASC)m->ql.ag=v.d[0];else{No*ag=ND(AG,lc);ag->ag.it=v;m->ql.ag=ag;}n=m;}else{S at=pat(p);No*m=ND(AT,lc);m->at.p=n;m->at.at=at;if(pm(p,T_LP)){do nv(&m->at.ar,pex(p));while(pm(p,T_CM));pe(p,T_RP);}n=m;}}else if(pa(p,T_LP)){pn(p);if(pa(p,T_RP)){pe(p,T_RP);No*m=ND(CL,lc);m->cl.fn=n;n=m;}else{NV v={0};do{NV ch={0};No*e=pex(p);if(e->k==N_ID&&pa(p,T_AR)){pn(p);No*a=ND(ASC,lc);nv(&a->asc.ch,e);a->asc.vl=pex(p);nv(&v,a);}else{nv(&ch,e);while(pm(p,T_BR))nv(&ch,pex(p));if(pa(p,T_AR)){pn(p);No*vl=pex(p);for(uint32_t i=0;i<ch.n;i++){No*a=ND(ASC,lc);nv(&a->asc.ch,ch.d[i]);a->asc.vl=vl;nv(&v,a);}}else{if(ch.n==1)nv(&v,ch.d[0]);else die(lc,"exp '=>'");}}}while(pm(p,T_CM));pe(p,T_RP);No*m=ND(CL,lc);m->cl.fn=n;m->cl.ar=v;n=m;}}else break;}return n;}
static No*ppw(Ps*p){No*n=ppr(p);if(pm(p,T_EX)){L lc=pl(p);No*m=ND(BIN,lc);m->bn.op=T_EX;m->bn.l=n;m->bn.r=ppw(p);return m;}return n;}
static No*pt(Ps*p){No*n=ppw(p);while(pa(p,T_ST)||pa(p,T_SL)||pa(p,T_MOD)||pa(p,T_REM)){Tk op=p->cr.t;pn(p);L lc=pl(p);No*m=ND(BIN,lc);m->bn.op=op;m->bn.l=n;m->bn.r=ppw(p);n=m;}return n;}
static No*psm(Ps*p){L lc=pl(p);Tk un=0;if(pm(p,T_MN))un=T_MN;else if(pm(p,T_PL))un=T_PL;No*n=pt(p);if(un){No*m=ND(UN,lc);m->un.op=un;m->un.x=n;n=m;}while(pa(p,T_PL)||pa(p,T_MN)||pa(p,T_AM)){Tk op=p->cr.t;pn(p);lc=pl(p);No*m=ND(BIN,lc);m->bn.op=op;m->bn.l=n;m->bn.r=pt(p);n=m;}return n;}
static No*prl(Ps*p){No*n=psm(p);if(pm(p,T_DD)){L lc=pl(p);No*m=ND(RN,lc);m->rn.lo=n;m->rn.hi=psm(p);return m;}if(pa(p,T_EQ)||pa(p,T_NE)||pa(p,T_LT)||pa(p,T_LE)||pa(p,T_GT)||pa(p,T_GE)||pa(p,T_IN)||pa(p,T_NOT)){Tk op=p->cr.t;pn(p);if(op==T_NOT)pe(p,T_IN);L lc=pl(p);No*m=ND(BIN,lc);m->bn.op=op;m->bn.l=n;if(op==T_IN||op==T_NOT)m->bn.r=prn(p);else m->bn.r=psm(p);return m;}return n;}
static No*pan(Ps*p){No*n=prl(p);while(pa(p,T_AND)||pa(p,T_ATHN)){Tk op=p->cr.t;pn(p);L lc=pl(p);No*m=ND(BIN,lc);m->bn.op=op;m->bn.l=n;m->bn.r=prl(p);n=m;}return n;}
static No*por(Ps*p){No*n=pan(p);while(pa(p,T_OR)||pa(p,T_OREL)||pa(p,T_XOR)){Tk op=p->cr.t;pn(p);L lc=pl(p);No*m=ND(BIN,lc);m->bn.op=op;m->bn.l=n;m->bn.r=pan(p);n=m;}return n;}
static No*pex(Ps*p){return por(p);}
static No*prn(Ps*p){L lc=pl(p);if(pm(p,T_BX)){No*n=ND(RN,lc);n->rn.lo=0;n->rn.hi=0;return n;}No*lo=psm(p);if(pm(p,T_DD)){No*m=ND(RN,lc);m->rn.lo=lo;m->rn.hi=psm(p);return m;}return lo;}
static No*psi(Ps*p){L lc=pl(p);No*n=ND(ID,lc);n->s=pi(p);for(;;){if(pm(p,T_DT)){if(pm(p,T_ALL)){No*m=ND(DRF,lc);m->drf.x=n;n=m;}else{No*m=ND(SEL,lc);m->se.p=n;m->se.se=pi(p);n=m;}}else if(pm(p,T_TK)){S at=pat(p);No*m=ND(AT,lc);m->at.p=n;m->at.at=at;if(pm(p,T_LP)){do nv(&m->at.ar,pex(p));while(pm(p,T_CM));pe(p,T_RP);}n=m;}else break;}if(pm(p,T_DELTA)){psm(p);}if(pm(p,T_DIG)){pex(p);}if(pm(p,T_RNG)){L lc=pl(p);No*c=ND(CN,lc);c->cn.rn=prn(p);No*m=ND(ST,lc);m->sd.in=n;m->sd.cn=c;return m;}if(pa(p,T_LP)){pn(p);L lc=pl(p);No*c=ND(CN,lc);do{L lc2=pl(p);No*r=prn(p);if(r->k==N_ID&&pm(p,T_RNG)){No*tn=ND(ID,lc2);tn->s=r->s;No*rng=prn(p);No*si=ND(ST,lc2);No*cn=ND(CN,lc2);cn->cn.rn=rng;si->sd.in=tn;si->sd.cn=cn;nv(&c->cn.cs,si);}else if(r->k==N_ID&&pm(p,T_AR)){No*a=ND(ASC,lc2);nv(&a->asc.ch,r);a->asc.vl=pex(p);nv(&c->cn.cs,a);}else{nv(&c->cn.cs,r);}}while(pm(p,T_CM));pe(p,T_RP);No*m=ND(ST,lc);m->sd.in=n;m->sd.cn=c;return m;}return n;}
static NV ppm(Ps*p){NV v={0};if(!pm(p,T_LP))return v;do{L lc=pl(p);NV id={0};do{S nm=pi(p);No*i=ND(ID,lc);i->s=nm;nv(&id,i);}while(pm(p,T_CM));pe(p,T_CL);uint8_t md=0;if(pm(p,T_IN))md|=1;if(pm(p,T_OUT))md|=2;if(!md)md=1;No*ty=pnm(p);No*df=0;if(pm(p,T_AS))df=pex(p);for(uint32_t i=0;i<id.n;i++){No*n=ND(PM,lc);n->pm.nm=id.d[i]->s;n->pm.ty=ty;n->pm.df=df;n->pm.md=md;nv(&v,n);}}while(pm(p,T_SC));pe(p,T_RP);return v;}
static No*pps_(Ps*p){L lc=pl(p);pe(p,T_PROC);No*n=ND(PS,lc);if(pa(p,T_STR)){n->sp.nm=p->cr.lit;pn(p);}else n->sp.nm=pi(p);n->sp.pmm=ppm(p);return n;}
static No*pfs(Ps*p){L lc=pl(p);pe(p,T_FUN);No*n=ND(FS,lc);if(pa(p,T_STR)){n->sp.nm=p->cr.lit;pn(p);}else n->sp.nm=pi(p);n->sp.pmm=ppm(p);pe(p,T_RET);n->sp.rt=pnm(p);return n;}
static No*ptd(Ps*p);
static NV pgfp(Ps*p){NV v={0};while(!pa(p,T_PROC)&&!pa(p,T_FUN)&&!pa(p,T_PKG)){if(pm(p,T_TYP)){L lc=pl(p);S nm=pi(p);bool isp=false;if(pm(p,T_LP)){while(!pa(p,T_RP))pn(p);pe(p,T_RP);}if(pm(p,T_IS)){if(pm(p,T_DIG)||pm(p,T_DELTA)||pm(p,T_RNG)){pe(p,T_BX);}else if(pm(p,T_LP)){pe(p,T_BX);pe(p,T_RP);isp=true;}else if(pm(p,T_LIM)||pa(p,T_ARR)||pa(p,T_REC)||pa(p,T_ACCS)||pa(p,T_PRV)){ptd(p);}else pex(p);}No*n=ND(GTP,lc);n->td.nm=nm;nv(&v,n);pe(p,T_SC);}else if(pm(p,T_WITH)){if(pa(p,T_PROC)){No*sp=pps_(p);sp->k=N_GSP;if(pm(p,T_IS)){if(!pm(p,T_BX)){while(!pa(p,T_SC))pn(p);}}nv(&v,sp);}else if(pa(p,T_FUN)){No*sp=pfs(p);sp->k=N_GSP;if(pm(p,T_IS)){if(!pm(p,T_BX)){while(!pa(p,T_SC))pn(p);}}nv(&v,sp);}else{L lc=pl(p);NV id={0};do{S nm=pi(p);No*i=ND(ID,lc);i->s=nm;nv(&id,i);}while(pm(p,T_CM));pe(p,T_CL);uint8_t md=0;if(pm(p,T_IN))md|=1;if(pm(p,T_OUT))md|=2;if(!md)md=1;No*ty=pnm(p);pm(p,T_AS);if(!pa(p,T_SC))pex(p);No*n=ND(GVL,lc);n->od.id=id;n->od.ty=ty;nv(&v,n);}pe(p,T_SC);}else{L lc=pl(p);NV id={0};do{S nm=pi(p);No*i=ND(ID,lc);i->s=nm;nv(&id,i);}while(pm(p,T_CM));pe(p,T_CL);uint8_t md=0;if(pm(p,T_IN))md|=1;if(pm(p,T_OUT))md|=2;if(!md)md=1;No*ty=pnm(p);pm(p,T_AS);if(!pa(p,T_SC))pex(p);No*n=ND(GVL,lc);n->od.id=id;n->od.ty=ty;nv(&v,n);pe(p,T_SC);}}return v;}
static No*pgf(Ps*p){L lc=pl(p);pe(p,T_GEN);No*n=ND(GEN,lc);n->gen.fp=pgfp(p);if(pa(p,T_PROC)){No*sp=pps_(p);pe(p,T_SC);n->gen.un=ND(PD,lc);n->gen.un->bd.sp=sp;return n;}if(pa(p,T_FUN)){No*sp=pfs(p);pe(p,T_SC);n->gen.un=ND(FD,lc);n->gen.un->bd.sp=sp;return n;}if(pm(p,T_PKG)){S nm=pi(p);pe(p,T_IS);NV dc=pdc(p);if(pm(p,T_PRV)){NV pr=pdc(p);for(uint32_t i=0;i<pr.n;i++)nv(&dc,pr.d[i]);}n->gen.dc=dc;pe(p,T_END);if(pa(p,T_ID))pn(p);pe(p,T_SC);No*pk=ND(PKS,lc);pk->ps.nm=nm;pk->ps.dc=n->gen.dc;n->gen.un=pk;return n;}return n;}
static No*pif(Ps*p){L lc=pl(p);pe(p,T_IF);No*n=ND(IF,lc);n->if_.cd=pex(p);pe(p,T_THEN);while(!pa(p,T_ELSIF)&&!pa(p,T_ELSE)&&!pa(p,T_END))nv(&n->if_.th,ps(p));while(pm(p,T_ELSIF)){No*e=ND(EL,lc);e->if_.cd=pex(p);pe(p,T_THEN);while(!pa(p,T_ELSIF)&&!pa(p,T_ELSE)&&!pa(p,T_END))nv(&e->if_.th,ps(p));nv(&n->if_.ei,e);}if(pm(p,T_ELSE))while(!pa(p,T_END))nv(&n->if_.el,ps(p));pe(p,T_END);pe(p,T_IF);pe(p,T_SC);return n;}
static No*pcs(Ps*p){L lc=pl(p);pe(p,T_CSE);No*n=ND(CS,lc);n->cs.ex=pex(p);pe(p,T_IS);while(pa(p,T_PGM))prc(p);while(pm(p,T_WHN)){No*a=ND(WH,lc);do{No*e=pex(p);if(e->k==N_ID&&pm(p,T_RNG)){No*r=prn(p);nv(&a->ch.it,r);}else if(pm(p,T_DD)){No*r=ND(RN,lc);r->rn.lo=e;r->rn.hi=pex(p);nv(&a->ch.it,r);}else nv(&a->ch.it,e);}while(pm(p,T_BR));pe(p,T_AR);while(!pa(p,T_WHN)&&!pa(p,T_END))nv(&a->hnd.stz,ps(p));nv(&n->cs.al,a);}pe(p,T_END);pe(p,T_CSE);pe(p,T_SC);return n;}
static No*plp(Ps*p,S lb){L lc=pl(p);No*n=ND(LP,lc);n->lp.lb=lb;if(pm(p,T_WHI))n->lp.it=pex(p);else if(pm(p,T_FOR)){S vr=pi(p);pe(p,T_IN);n->lp.rv=pm(p,T_REV);No*rng=prn(p);if(pm(p,T_RNG)){No*r=ND(RN,lc);r->rn.lo=psm(p);pe(p,T_DD);r->rn.hi=psm(p);rng=r;}No*it=ND(BIN,lc);it->bn.op=T_IN;it->bn.l=ND(ID,lc);it->bn.l->s=vr;it->bn.r=rng;n->lp.it=it;}pe(p,T_LOOP);while(!pa(p,T_END))nv(&n->lp.st,ps(p));pe(p,T_END);pe(p,T_LOOP);if(pa(p,T_ID))pn(p);pe(p,T_SC);return n;}
static No*pbk(Ps*p,S lb){L lc=pl(p);No*n=ND(BL,lc);n->bk.lb=lb;if(pm(p,T_DEC))n->bk.dc=pdc(p);pe(p,T_BEG);while(!pa(p,T_EXCP)&&!pa(p,T_END))nv(&n->bk.st,ps(p));if(pm(p,T_EXCP))n->bk.hd=phd(p);pe(p,T_END);if(pa(p,T_ID))pn(p);pe(p,T_SC);return n;}
static No*psl(Ps*p){L lc=pl(p);pe(p,T_SEL);No*n=ND(SA,lc);n->sa.kn=0;if(pm(p,T_DEL)){n->sa.kn=1;n->sa.gd=pex(p);pe(p,T_THEN);if(pm(p,T_AB))n->sa.kn=3;while(!pa(p,T_OR)&&!pa(p,T_ELSE)&&!pa(p,T_END))nv(&n->sa.sts,ps(p));}else if(pa(p,T_WHN)){while(pm(p,T_WHN)){No*g=ND(WH,lc);do nv(&g->ch.it,pex(p));while(pm(p,T_BR));pe(p,T_AR);if(pm(p,T_ACC)){g->k=N_ACC;g->acc.nm=pi(p);if(pa(p,T_LP)){if(p->pk.t==T_ID){Tn scr=p->cr,spk=p->pk;Lx slx=p->lx;pn(p);pn(p);if(p->cr.t==T_CM||p->cr.t==T_CL){p->cr=scr;p->pk=spk;p->lx=slx;g->acc.pmx=ppm(p);}else{p->cr=scr;p->pk=spk;p->lx=slx;pe(p,T_LP);do nv(&g->acc.ixx,pex(p));while(pm(p,T_CM));pe(p,T_RP);g->acc.pmx=ppm(p);}}else{pe(p,T_LP);do nv(&g->acc.ixx,pex(p));while(pm(p,T_CM));pe(p,T_RP);g->acc.pmx=ppm(p);}}else{g->acc.pmx=ppm(p);}if(pm(p,T_DO)){while(!pa(p,T_END)&&!pa(p,T_OR)&&!pa(p,T_ELSE))nv(&g->acc.stx,ps(p));pe(p,T_END);if(pa(p,T_ID))pn(p);}}else if(pm(p,T_TER)){g->k=N_TRM;}else if(pm(p,T_DEL)){g->k=N_DL;g->ex.cd=pex(p);pe(p,T_THEN);while(!pa(p,T_OR)&&!pa(p,T_ELSE)&&!pa(p,T_END))nv(&g->hnd.stz,ps(p));}nv(&n->sa.sts,g);}}else{do{No*g=ND(WH,lc);if(pm(p,T_ACC)){g->k=N_ACC;g->acc.nm=pi(p);if(pa(p,T_LP)){if(p->pk.t==T_ID){Tn scr=p->cr,spk=p->pk;Lx slx=p->lx;pn(p);pn(p);if(p->cr.t==T_CM||p->cr.t==T_CL){p->cr=scr;p->pk=spk;p->lx=slx;g->acc.pmx=ppm(p);}else{p->cr=scr;p->pk=spk;p->lx=slx;pe(p,T_LP);do nv(&g->acc.ixx,pex(p));while(pm(p,T_CM));pe(p,T_RP);g->acc.pmx=ppm(p);}}else{pe(p,T_LP);do nv(&g->acc.ixx,pex(p));while(pm(p,T_CM));pe(p,T_RP);g->acc.pmx=ppm(p);}}else{g->acc.pmx=ppm(p);}if(pm(p,T_DO)){while(!pa(p,T_END)&&!pa(p,T_OR)&&!pa(p,T_ELSE))nv(&g->acc.stx,ps(p));pe(p,T_END);if(pa(p,T_ID))pn(p);}pe(p,T_SC);}else if(pm(p,T_DEL)){g->k=N_DL;g->ex.cd=pex(p);pe(p,T_SC);}else if(pm(p,T_TER)){g->k=N_TRM;pe(p,T_SC);}else{while(!pa(p,T_OR)&&!pa(p,T_ELSE)&&!pa(p,T_END))nv(&g->hnd.stz,ps(p));}nv(&n->sa.sts,g);}while(pm(p,T_OR));}if(pm(p,T_ELSE))while(!pa(p,T_END))nv(&n->ss.el,ps(p));pe(p,T_END);pe(p,T_SEL);pe(p,T_SC);return n;}
static No*ps(Ps*p){L lc=pl(p);S lb=N;while(pa(p,T_LL)){pn(p);lb=pi(p);pe(p,T_GG);slv(&p->lb,lb);}if(!lb.s&&pa(p,T_ID)&&p->pk.t==T_CL){lb=pi(p);pe(p,T_CL);slv(&p->lb,lb);}if(pa(p,T_IF))return pif(p);if(pa(p,T_CSE))return pcs(p);if(pa(p,T_SEL))return psl(p);if(pa(p,T_LOOP)||pa(p,T_WHI)||pa(p,T_FOR))return plp(p,lb);if(pa(p,T_DEC)||pa(p,T_BEG))return pbk(p,lb);if(pm(p,T_ACC)){No*n=ND(ACC,lc);n->acc.nm=pi(p);if(pa(p,T_LP)){if(p->pk.t==T_ID){Tn scr=p->cr,spk=p->pk;Lx slx=p->lx;pn(p);pn(p);if(p->cr.t==T_CM||p->cr.t==T_CL){p->cr=scr;p->pk=spk;p->lx=slx;n->acc.pmx=ppm(p);}else{p->cr=scr;p->pk=spk;p->lx=slx;pe(p,T_LP);do nv(&n->acc.ixx,pex(p));while(pm(p,T_CM));pe(p,T_RP);n->acc.pmx=ppm(p);}}else{pe(p,T_LP);do nv(&n->acc.ixx,pex(p));while(pm(p,T_CM));pe(p,T_RP);n->acc.pmx=ppm(p);}}else{n->acc.pmx=ppm(p);}if(pm(p,T_DO)){while(!pa(p,T_END))nv(&n->acc.stx,ps(p));pe(p,T_END);if(pa(p,T_ID))pn(p);}pe(p,T_SC);return n;}if(pm(p,T_DEL)){No*n=ND(DL,lc);n->ex.cd=pex(p);pe(p,T_SC);return n;}if(pm(p,T_AB)){No*n=ND(AB,lc);if(!pa(p,T_SC))n->rs.ec=pnm(p);pe(p,T_SC);return n;}if(pm(p,T_RET)){No*n=ND(RT,lc);if(!pa(p,T_SC))n->rt.vl=pex(p);pe(p,T_SC);return n;}if(pm(p,T_EXIT)){No*n=ND(EX,lc);if(pa(p,T_ID))n->ex.lb=pi(p);if(pm(p,T_WHN))n->ex.cd=pex(p);pe(p,T_SC);return n;}if(pm(p,T_GOTO)){No*n=ND(GT,lc);n->go.lb=pi(p);pe(p,T_SC);return n;}if(pm(p,T_RAS)){No*n=ND(RS,lc);if(!pa(p,T_SC))n->rs.ec=pnm(p);pe(p,T_SC);return n;}if(pm(p,T_NULL)){pe(p,T_SC);return ND(NS,lc);}if(pm(p,T_PGM)){No*n=ND(PG,lc);n->pg.nm=pi(p);if(pm(p,T_LP)){do nv(&n->pg.ar,pex(p));while(pm(p,T_CM));pe(p,T_RP);}pe(p,T_SC);return n;}No*e=pnm(p);if(pm(p,T_AS)){No*n=ND(AS,lc);if(e&&e->k==N_CL){No*fn=e->cl.fn;NV ar=e->cl.ar;e->k=N_IX;e->ix.p=fn;e->ix.ix=ar;}n->as.tg=e;n->as.vl=pex(p);pe(p,T_SC);return n;}No*n=ND(CLT,lc);if(e->k==N_IX){n->ct.nm=e->ix.p;n->ct.arr=e->ix.ix;}else if(e->k==N_CL){n->ct.nm=e->cl.fn;n->ct.arr=e->cl.ar;}else n->ct.nm=e;pe(p,T_SC);return n;}
static NV pst(Ps*p){NV v={0};while(!pa(p,T_END)&&!pa(p,T_EXCP)&&!pa(p,T_ELSIF)&&!pa(p,T_ELSE)&&!pa(p,T_WHN)&&!pa(p,T_OR))nv(&v,ps(p));return v;}
static NV phd(Ps*p){NV v={0};while(pm(p,T_WHN)){L lc=pl(p);No*h=ND(HD,lc);do{if(pm(p,T_OTH)){No*n=ND(ID,lc);n->s=Z("others");nv(&h->hnd.ec,n);}else nv(&h->hnd.ec,pnm(p));}while(pm(p,T_BR));pe(p,T_AR);while(!pa(p,T_WHN)&&!pa(p,T_END))nv(&h->hnd.stz,ps(p));nv(&v,h);}return v;}
static No*ptd(Ps*p){L lc=pl(p);if(pm(p,T_LP)){No*n=ND(TE,lc);do{if(pa(p,T_CHAR)){No*c=ND(CHAR,lc);c->i=p->cr.iv;pn(p);nv(&n->lst.it,c);}else{S nm=pi(p);No*i=ND(ID,lc);i->s=nm;nv(&n->lst.it,i);}}while(pm(p,T_CM));pe(p,T_RP);return n;}if(pm(p,T_RNG)){No*n=ND(TI,lc);if(pm(p,T_BX)){n->rn.lo=0;n->rn.hi=0;}else{n->rn.lo=psm(p);pe(p,T_DD);n->rn.hi=psm(p);}return n;}if(pm(p,T_MOD)){No*n=ND(TI,lc);n->un.op=T_MOD;n->un.x=pex(p);return n;}if(pm(p,T_DIG)){No*n=ND(TF,lc);if(pm(p,T_BX))n->un.x=0;else n->un.x=pex(p);if(pm(p,T_RNG)){n->rn.lo=psm(p);pe(p,T_DD);n->rn.hi=psm(p);}return n;}if(pm(p,T_DELTA)){No*n=ND(TX,lc);if(pm(p,T_BX)){n->rn.lo=0;n->rn.hi=0;n->bn.r=0;}else{n->rn.lo=pex(p);pe(p,T_RNG);n->rn.hi=psm(p);pe(p,T_DD);n->bn.r=psm(p);}return n;}if(pm(p,T_ARR)){pe(p,T_LP);No*n=ND(TA,lc);do{No*ix=prn(p);if(ix->k==N_ID&&pm(p,T_RNG)){No*st=ND(ST,lc);st->sd.in=ix;No*cn=ND(CN,lc);cn->cn.rn=prn(p);st->sd.cn=cn;nv(&n->ix.ix,st);}else nv(&n->ix.ix,ix);}while(pm(p,T_CM));pe(p,T_RP);pe(p,T_OF);n->ix.p=psi(p);return n;}if(pm(p,T_REC)){No*n=ND(TR,lc);uint32_t of=0;NV dc={0};if(pm(p,T_LP)){do{S dn=pi(p);pe(p,T_CL);No*dt=pnm(p);No*dd=0;if(pm(p,T_AS))dd=pex(p);No*dp=ND(DS,lc);dp->pm.nm=dn;dp->pm.ty=dt;dp->pm.df=dd;nv(&dc,dp);}while(pm(p,T_SC));pe(p,T_RP);if(!pa(p,T_IS))pe(p,T_SC);}if(pm(p,T_IS)){pe(p,T_REC);}while(!pa(p,T_END)&&!pa(p,T_CSE)&&!pa(p,T_NULL)){NV id={0};do{S nm=pi(p);No*i=ND(ID,lc);i->s=nm;nv(&id,i);}while(pm(p,T_CM));pe(p,T_CL);No*ty=psi(p);No*in=0;if(pm(p,T_AS))in=pex(p);pe(p,T_SC);for(uint32_t i=0;i<id.n;i++){No*c=ND(CM,lc);c->cm.nm=id.d[i]->s;c->cm.ty=ty;c->cm.in=in;c->cm.of=of++;c->cm.dc=0;c->cm.dsc=0;if(dc.n>0){c->cm.dc=ND(LST,lc);c->cm.dc->lst.it=dc;}nv(&n->lst.it,c);}}if(pm(p,T_NULL)){pe(p,T_SC);}if(pm(p,T_CSE)){No*vp=ND(VP,lc);vp->vp.ds=pnm(p);pe(p,T_IS);while(pm(p,T_WHN)){No*v=ND(VR,lc);do{No*e=pex(p);if(pm(p,T_DD)){No*r=ND(RN,lc);r->rn.lo=e;r->rn.hi=pex(p);e=r;}nv(&v->vr.ch,e);}while(pm(p,T_BR));pe(p,T_AR);while(!pa(p,T_WHN)&&!pa(p,T_END)&&!pa(p,T_NULL)){NV id={0};do{S nm=pi(p);No*i=ND(ID,lc);i->s=nm;nv(&id,i);}while(pm(p,T_CM));pe(p,T_CL);No*ty=psi(p);No*in=0;if(pm(p,T_AS))in=pex(p);pe(p,T_SC);for(uint32_t i=0;i<id.n;i++){No*c=ND(CM,lc);c->cm.nm=id.d[i]->s;c->cm.ty=ty;c->cm.in=in;c->cm.of=of++;c->cm.dc=0;c->cm.dsc=0;if(dc.n>0){c->cm.dc=ND(LST,lc);c->cm.dc->lst.it=dc;}nv(&v->vr.cmm,c);}}if(pm(p,T_NULL))pe(p,T_SC);nv(&vp->vp.vrr,v);}vp->vp.sz=of;if(pm(p,T_NULL)){pe(p,T_REC);}pe(p,T_END);pe(p,T_CSE);pe(p,T_SC);nv(&n->lst.it,vp);}pe(p,T_END);pe(p,T_REC);return n;}if(pm(p,T_ACCS)){No*n=ND(TAC,lc);n->un.x=psi(p);return n;}if(pm(p,T_PRV))return ND(TP,lc);if(pm(p,T_LIM)){pm(p,T_PRV);return ND(TP,lc);}return psi(p);}
static RC*prc(Ps*p){L lc=pl(p);if(pm(p,T_FOR)){pnm(p);pe(p,T_USE);if(pm(p,T_AT)){RC*r=rc(2,0);pex(p);pe(p,T_SC);return r;}if(pm(p,T_REC)){while(!pa(p,T_END)){pi(p);pe(p,T_AT);pex(p);pe(p,T_RNG);prn(p);pe(p,T_SC);}pe(p,T_END);pe(p,T_REC);pe(p,T_SC);return 0;}pex(p);pe(p,T_SC);return 0;}if(pm(p,T_PGM)){S nm=pi(p);RC*r=0;if(si(nm,Z("SUPPRESS"))){if(pa(p,T_LP)){pe(p,T_LP);S ck=pi(p);uint16_t cm=si(ck,Z("OVERFLOW_CHECK"))?CHK_OVF:si(ck,Z("RANGE_CHECK"))?CHK_RNG:si(ck,Z("INDEX_CHECK"))?CHK_IDX:si(ck,Z("DISCRIMINANT_CHECK"))?CHK_DSC:si(ck,Z("LENGTH_CHECK"))?CHK_LEN:si(ck,Z("DIVISION_CHECK"))?CHK_DIV:si(ck,Z("ELABORATION_CHECK"))?CHK_ELB:si(ck,Z("ACCESS_CHECK"))?CHK_ACC:si(ck,Z("STORAGE_CHECK"))?CHK_STG:0;if(cm){r=rc(4,0);r->ad.nm=pm(p,T_CM)?pi(p):N;while(pm(p,T_CM))pi(p);r->ad.ad=cm;}else{while(pm(p,T_CM))pi(p);}pe(p,T_RP);}pe(p,T_SC);return r;}else if(si(nm,Z("PACK"))){if(pa(p,T_LP)){pe(p,T_LP);S tn=pi(p);while(pm(p,T_CM))pi(p);pe(p,T_RP);r=rc(5,0);r->er.nm=tn;}pe(p,T_SC);return r;}else if(si(nm,Z("INLINE"))){if(pa(p,T_LP)){pe(p,T_LP);r=rc(6,0);r->er.nm=pi(p);while(pm(p,T_CM))pi(p);pe(p,T_RP);}pe(p,T_SC);return r;}else if(si(nm,Z("CONTROLLED"))){if(pa(p,T_LP)){pe(p,T_LP);r=rc(7,0);r->er.nm=pi(p);while(pm(p,T_CM))pi(p);pe(p,T_RP);}pe(p,T_SC);return r;}else if(si(nm,Z("INTERFACE"))||si(nm,Z("IMPORT"))){if(pa(p,T_LP)){pe(p,T_LP);r=rc(8,0);r->im.lang=pi(p);if(pm(p,T_CM)){r->im.nm=pi(p);if(pm(p,T_CM)){if(pa(p,T_STR)){r->im.ext=p->cr.lit;pn(p);}else r->im.ext=pi(p);}else r->im.ext=r->im.nm;}pe(p,T_RP);}pe(p,T_SC);return r;}else if(si(nm,Z("OPTIMIZE"))||si(nm,Z("PRIORITY"))||si(nm,Z("STORAGE_SIZE"))||si(nm,Z("SHARED"))||si(nm,Z("LIST"))||si(nm,Z("PAGE"))){if(pm(p,T_LP)){do pex(p);while(pm(p,T_CM));pe(p,T_RP);}pe(p,T_SC);return 0;}else{if(si(nm,Z("ELABORATE"))||si(nm,Z("ELABORATE_ALL"))){pe(p,T_LP);do pi(p);while(pm(p,T_CM));pe(p,T_RP);}else if(pm(p,T_LP)){do pi(p);while(pm(p,T_CM));pe(p,T_RP);}pe(p,T_SC);}}return 0;}
static No*pdl(Ps*p){L lc=pl(p);if(pa(p,T_GEN))return pgf(p);if(pm(p,T_TYP)){S nm=pi(p);No*n=ND(TD,lc);n->td.nm=nm;if(pm(p,T_LP)){No*ds=ND(LST,lc);do{NV dn={0};do{S dnm=pi(p);No*di=ND(ID,lc);di->s=dnm;nv(&dn,di);}while(pm(p,T_CM));pe(p,T_CL);No*dt=pnm(p);No*dd=0;if(pm(p,T_AS))dd=pex(p);for(uint32_t i=0;i<dn.n;i++){No*dp=ND(DS,lc);dp->pm.nm=dn.d[i]->s;dp->pm.ty=dt;dp->pm.df=dd;nv(&ds->lst.it,dp);}}while(pm(p,T_SC));pe(p,T_RP);n->td.dsc=ds->lst.it;}if(pm(p,T_IS)){n->td.nw=pm(p,T_NEW);n->td.drv=n->td.nw;if(n->td.drv){n->td.prt=pnm(p);n->td.df=n->td.prt;if(pm(p,T_DIG)){pex(p);if(pm(p,T_RNG)){psm(p);pe(p,T_DD);psm(p);}}else if(pm(p,T_DELTA)){pex(p);pe(p,T_RNG);psm(p);pe(p,T_DD);psm(p);}else if(pm(p,T_RNG)){No*rn=ND(RN,lc);rn->rn.lo=psm(p);pe(p,T_DD);rn->rn.hi=psm(p);n->td.df=rn;}}else n->td.df=ptd(p);}pe(p,T_SC);return n;}if(pm(p,T_SUB)){S nm=pi(p);pe(p,T_IS);No*n=ND(SD,lc);n->sd.nm=nm;n->sd.in=psi(p);if(n->sd.in->k==N_ST)n->sd.rn=n->sd.in->sd.cn->cn.rn;pe(p,T_SC);return n;}if(pa(p,T_PROC)){No*sp=pps_(p);if(pm(p,T_REN)){pex(p);pe(p,T_SC);No*n=ND(PD,lc);n->bd.sp=sp;return n;}if(pm(p,T_IS)){if(pm(p,T_SEP)){pe(p,T_SC);No*n=ND(PD,lc);n->bd.sp=sp;return n;}if(pm(p,T_NEW)){S gn=pi(p);NV ap={0};if(pm(p,T_LP)){do{No*e=pex(p);if(e->k==N_ID&&pa(p,T_AR)){pn(p);No*a=ND(ASC,lc);nv(&a->asc.ch,e);a->asc.vl=pex(p);nv(&ap,a);}else{nv(&ap,e);}}while(pm(p,T_CM));pe(p,T_RP);}pe(p,T_SC);No*n=ND(GINST,lc);n->gi.gn=gn;n->gi.ap=ap;return n;}No*n=ND(PB,lc);n->bd.sp=sp;n->bd.dc=pdc(p);pe(p,T_BEG);n->bd.st=pst(p);if(pm(p,T_EXCP))n->bd.hdd=phd(p);pe(p,T_END);if(pa(p,T_ID)||pa(p,T_STR))pn(p);pe(p,T_SC);return n;}pe(p,T_SC);No*n=ND(PD,lc);n->bd.sp=sp;return n;}if(pm(p,T_FUN)){S nm;if(pa(p,T_STR)){nm=p->cr.lit;pn(p);}else nm=pi(p);if(pm(p,T_IS)&&pm(p,T_NEW)){S gn=pi(p);NV ap={0};if(pm(p,T_LP)){do{No*e=pex(p);if(e->k==N_ID&&pa(p,T_AR)){pn(p);No*a=ND(ASC,lc);nv(&a->asc.ch,e);a->asc.vl=pex(p);nv(&ap,a);}else{nv(&ap,e);}}while(pm(p,T_CM));pe(p,T_RP);}pe(p,T_SC);No*n=ND(GINST,lc);n->gi.gn=gn;n->gi.ap=ap;return n;}No*sp=ND(FS,lc);sp->sp.nm=nm;sp->sp.pmm=ppm(p);pe(p,T_RET);sp->sp.rt=pnm(p);if(pm(p,T_REN)){pex(p);pe(p,T_SC);No*n=ND(FD,lc);n->bd.sp=sp;return n;}if(pm(p,T_IS)){if(pm(p,T_SEP)){pe(p,T_SC);No*n=ND(FD,lc);n->bd.sp=sp;return n;}No*n=ND(FB,lc);n->bd.sp=sp;n->bd.dc=pdc(p);pe(p,T_BEG);n->bd.st=pst(p);if(pm(p,T_EXCP))n->bd.hdd=phd(p);pe(p,T_END);if(pa(p,T_ID)||pa(p,T_STR))pn(p);pe(p,T_SC);return n;}pe(p,T_SC);No*n=ND(FD,lc);n->bd.sp=sp;return n;}if(pm(p,T_PKG)){if(pm(p,T_BOD)){S nm=pi(p);pe(p,T_IS);if(pm(p,T_SEP)){pe(p,T_SC);No*n=ND(PKB,lc);n->pb.nm=nm;return n;}No*n=ND(PKB,lc);n->pb.nm=nm;n->pb.dc=pdc(p);if(pm(p,T_BEG)){n->pb.st=pst(p);if(pm(p,T_EXCP))n->pb.hddd=phd(p);}pe(p,T_END);if(pa(p,T_ID))pn(p);pe(p,T_SC);return n;}S nm=pi(p);pe(p,T_IS);if(pm(p,T_NEW)){S gn=pi(p);NV ap={0};if(pm(p,T_LP)){do{No*e=pex(p);if(e->k==N_ID&&pa(p,T_AR)){pn(p);No*a=ND(ASC,lc);nv(&a->asc.ch,e);a->asc.vl=pex(p);nv(&ap,a);}else{nv(&ap,e);}}while(pm(p,T_CM));pe(p,T_RP);}pe(p,T_SC);No*n=ND(GINST,lc);n->gi.gn=gn;n->gi.ap=ap;return n;}No*n=ND(PKS,lc);n->ps.nm=nm;n->ps.dc=pdc(p);if(pm(p,T_PRV))n->ps.pr=pdc(p);pe(p,T_END);if(pa(p,T_ID))pn(p);pe(p,T_SC);return n;}if(pm(p,T_TSK)){if(pm(p,T_BOD)){S nm=pi(p);pe(p,T_IS);if(pm(p,T_SEP)){pe(p,T_SC);No*n=ND(TKB,lc);n->tb.nm=nm;return n;}No*n=ND(TKB,lc);n->tb.nm=nm;n->tb.dc=pdc(p);pe(p,T_BEG);n->tb.st=pst(p);if(pm(p,T_EXCP))n->tb.hdz=phd(p);pe(p,T_END);if(pa(p,T_ID))pn(p);pe(p,T_SC);return n;}bool it=pm(p,T_TYP);S nm=pi(p);No*n=ND(TKS,lc);n->ts.nm=nm;n->ts.it=it;if(pm(p,T_IS)){while(!pa(p,T_END)){if(pm(p,T_ENT)){No*e=ND(ENT,lc);e->ent.nm=pi(p);if(pa(p,T_LP)){if(p->pk.t==T_ID||p->pk.t==T_INT||p->pk.t==T_CHAR){Tn scr=p->cr,spk=p->pk;Lx slx=p->lx;pn(p);pn(p);if(p->cr.t==T_CM||p->cr.t==T_CL){p->cr=scr;p->pk=spk;p->lx=slx;e->ent.pmy=ppm(p);}else{p->cr=scr;p->pk=spk;p->lx=slx;pe(p,T_LP);No*ix=prn(p);if(ix->k!=N_RN&&pm(p,T_RNG)){No*rng=prn(p);No*si=ND(ST,lc);No*cn=ND(CN,lc);cn->cn.rn=rng;si->sd.in=ix;si->sd.cn=cn;nv(&e->ent.ixy,si);}else{nv(&e->ent.ixy,ix);}pe(p,T_RP);e->ent.pmy=ppm(p);}}else{pe(p,T_LP);No*ix=prn(p);if(ix->k!=N_RN&&pm(p,T_RNG)){No*rng=prn(p);No*si=ND(ST,lc);No*cn=ND(CN,lc);cn->cn.rn=rng;si->sd.in=ix;si->sd.cn=cn;nv(&e->ent.ixy,si);}else{nv(&e->ent.ixy,ix);}pe(p,T_RP);e->ent.pmy=ppm(p);}}else{e->ent.pmy=ppm(p);}pe(p,T_SC);nv(&n->ts.en,e);}else if(pm(p,T_PGM)){pi(p);if(pm(p,T_LP)){do pex(p);while(pm(p,T_CM));pe(p,T_RP);}pe(p,T_SC);}}pe(p,T_END);if(pa(p,T_ID))pn(p);}pe(p,T_SC);return n;}if(pm(p,T_USE)){NV nms={0};do nv(&nms,pnm(p));while(pm(p,T_CM));pe(p,T_SC);if(nms.n==1){No*n=ND(US,lc);n->us.nm=nms.d[0];return n;}No*lst=ND(LST,lc);for(uint32_t i=0;i<nms.n;i++){No*u=ND(US,lc);u->us.nm=nms.d[i];nv(&lst->lst.it,u);}return lst;}if(pm(p,T_PGM)){No*n=ND(PG,lc);n->pg.nm=pi(p);if(pm(p,T_LP)){do nv(&n->pg.ar,pex(p));while(pm(p,T_CM));pe(p,T_RP);}pe(p,T_SC);return n;}{NV id={0};do{S nm=pi(p);No*i=ND(ID,lc);i->s=nm;nv(&id,i);}while(pm(p,T_CM));pe(p,T_CL);bool co=pm(p,T_CONST);if(pm(p,T_EXCP)){No*n=ND(ED,lc);n->ed.id=id;pe(p,T_SC);return n;}No*ty=0;if(!pa(p,T_AS)){if(pa(p,T_ARR)||pa(p,T_ACCS))ty=ptd(p);else ty=psi(p);}No*in=0;if(pm(p,T_REN))in=pex(p);else if(pm(p,T_AS))in=pex(p);pe(p,T_SC);No*n=ND(OD,lc);n->od.id=id;n->od.ty=ty;n->od.in=in;n->od.co=co;return n;}}
static NV pdc(Ps*p){NV v={0};while(!pa(p,T_BEG)&&!pa(p,T_END)&&!pa(p,T_PRV)&&!pa(p,T_EOF)&&!pa(p,T_ENT)){if(pa(p,T_FOR)){RC*r=prc(p);if(r){No*n=ND(RRC,pl(p));memcpy(&n->ag.it.d,&r,sizeof(RC*));nv(&v,n);}continue;}if(pa(p,T_PGM)){RC*r=prc(p);if(r){No*n=ND(RRC,pl(p));memcpy(&n->ag.it.d,&r,sizeof(RC*));nv(&v,n);}continue;}nv(&v,pdl(p));}return v;}
static No*pcx(Ps*p){L lc=pl(p);No*cx=ND(CX,lc);while(pa(p,T_WITH)||pa(p,T_USE)||pa(p,T_PGM)){if(pm(p,T_WITH)){do{No*w=ND(WI,lc);w->wt.nm=pi(p);nv(&cx->cx.wt,w);}while(pm(p,T_CM));pe(p,T_SC);}else if(pm(p,T_USE)){do{No*u=ND(US,lc);u->us.nm=pnm(p);nv(&cx->cx.us,u);}while(pm(p,T_CM));pe(p,T_SC);}else{No*pg=pdl(p);if(pg)nv(&cx->cx.us,pg);}}return cx;}
static No*pcu(Ps*p){L lc=pl(p);No*n=ND(CU,lc);n->cu.cx=pcx(p);while(pa(p,T_WITH)||pa(p,T_USE)||pa(p,T_PROC)||pa(p,T_FUN)||pa(p,T_PKG)||pa(p,T_GEN)||pa(p,T_PGM)){if(pa(p,T_WITH)||pa(p,T_USE)||pa(p,T_PGM)){No*cx=pcx(p);for(uint32_t i=0;i<cx->cx.wt.n;i++)nv(&n->cu.cx->cx.wt,cx->cx.wt.d[i]);for(uint32_t i=0;i<cx->cx.us.n;i++)nv(&n->cu.cx->cx.us,cx->cx.us.d[i]);}else nv(&n->cu.un,pdl(p));}return n;}
static Ps pnw(const char*s,size_t z,const char*f){Ps p={ln(s,z,f)};pn(&p);pn(&p);return p;}
typedef enum{TY_V=0,TY_I,TY_B,TY_C,TY_F,TY_E,TY_A,TY_R,TY_AC,TY_T,TY_S,TY_P,TY_UI,TY_UF,TY_D,TY_PT,TY_FT,TY_FX}Tk_;
struct Ty{Tk_ k;S nm;Ty*bs,*el,*prt;int64_t lo,hi;NV cm,dc;uint32_t sz,al;SV ev;RV rc;uint64_t ad;bool pk;NV ops;int64_t sm,lg;uint16_t sup;bool ctrl;uint8_t frz;No*fzn;};
struct Sy{S nm;uint8_t k;Ty*ty;No*df;Sy*nx,*pv;int sc;int ss;int64_t vl;uint32_t of;NV ol;SV us;int el;GT*gt;Sy*pr;int lv;bool inl;bool shrd;bool ext;S ext_nm;S ext_lang;uint8_t frz;No*fzn;};
typedef struct{Sy*sy[4096];int sc;int ss;No*ds;No*pk;SV uv;int eo;LV lu;GV gt;jmp_buf*eb[16];int ed;S ce[16];FV io;int fn;SLV lb;int lv;}Sm;
static uint32_t syh(S s){return sh(s)&4095;}
static Sy*syn(S nm,uint8_t k,Ty*ty,No*df){Sy*s=al(sizeof(Sy));s->nm=nm;s->k=k;s->ty=ty;s->df=df;s->el=-1;s->lv=-1;return s;}
static Sy*sya(Sm*SM,Sy*s){uint32_t h=syh(s->nm);s->nx=SM->sy[h];s->sc=SM->sc;s->ss=SM->ss;s->el=SM->eo++;s->lv=SM->lv;SM->sy[h]=s;return s;}
static Sy*syf(Sm*SM,S nm){Sy*best=0;for(Sy*s=SM->sy[syh(nm)];s;s=s->nx)if(si(s->nm,nm)&&(!best||s->sc>best->sc))best=s;if(!best)for(uint32_t i=0;i<SM->uv.n;i++)for(Sy*u=SM->uv.d[i];u;u=u->nx)if(si(u->nm,nm)&&(!best||u->sc>best->sc))best=u;return best;}
static void sfu(Sm*SM,Sy*s,S nm){for(Sy*p=s;p;p=p->nx)if(si(p->nm,nm)&&p->k==6&&p->df&&p->df->k==N_PKS){No*pk=p->df;for(uint32_t i=0;i<pk->ps.dc.n;i++){No*d=pk->ps.dc.d[i];if(d->sy)sv(&s->us,d->sy);}}}
static GT*gfnd(Sm*SM,S nm){for(uint32_t i=0;i<SM->gt.n;i++){GT*g=SM->gt.d[i];if(si(g->nm,nm))return g;}return 0;}
static int tysc(Ty*a,Ty*b,Ty*tx){if(!a||!b)return 0;if(a==b)return 1000;if(a->prt==b||b->prt==a)return 900;if(a->bs==b||b->bs==a)return 800;if((a->k==TY_I||a->k==TY_UI)&&(b->k==TY_I||b->k==TY_UI))return 700;if((a->k==TY_F||a->k==TY_UF)&&(b->k==TY_F||b->k==TY_UF))return 700;if(a->k==TY_AC&&b->k==TY_AC&&a->el&&b->el)return 500+tysc(a->el,b->el,0);if(tx&&a->el&&b==tx)return 400;return 0;}
static Sy*syfa(Sm*SM,S nm,int na,Ty*tx){SV cv={0};for(Sy*s=SM->sy[syh(nm)];s;s=s->nx)if(si(s->nm,nm))sv(&cv,s);for(uint32_t i=0;i<SM->uv.n;i++)for(Sy*u=SM->uv.d[i];u;u=u->nx)if(si(u->nm,nm))sv(&cv,u);if(!cv.n)return 0;if(cv.n==1)return cv.d[0];Sy*br=0;int bs=-1;for(uint32_t i=0;i<cv.n;i++){Sy*c=cv.d[i];int sc=0;if((c->k==4||c->k==5)&&na>=0){if(c->ol.n>0){for(uint32_t j=0;j<c->ol.n;j++){No*b=c->ol.d[j];if(b->k==N_PB||b->k==N_FB){int np=b->bd.sp->sp.pmm.n;if(np==na){sc+=1000;if(tx&&c->ty&&c->ty->el){int ts=tysc(c->ty->el,tx,0);sc+=ts;}for(uint32_t k=0;k<b->bd.sp->sp.pmm.n&&k<(uint32_t)na;k++){No*p=b->bd.sp->sp.pmm.d[k];if(p->sy&&p->sy->ty&&tx){int ps=tysc(p->sy->ty,tx,0);sc+=ps;}}if(sc>bs){bs=sc;br=c;}}}}}else if(c->k==1){if(na==1){sc=500;if(tx){int ts=tysc(c->ty,tx,0);sc+=ts;}if(sc>bs){bs=sc;br=c;}}}}else if(c->k==1&&na<0){sc=100;if(sc>bs){bs=sc;br=c;}}}return br?:cv.d[0];}
static Ty*tyn(Tk_ k,S nm){Ty*t=al(sizeof(Ty));t->k=k;t->nm=nm;t->sz=8;t->al=8;return t;}
static Ty*TY_INT,*TY_BOOL,*TY_CHAR,*TY_STR,*TY_FLT,*TY_UINT,*TY_UFLT,*TY_FILE,*TY_NAT,*TY_POS;
static void smi(Sm*SM){memset(SM,0,sizeof(*SM));TY_INT=tyn(TY_I,Z("INTEGER"));TY_INT->lo=-2147483648LL;TY_INT->hi=2147483647LL;TY_NAT=tyn(TY_I,Z("NATURAL"));TY_NAT->lo=0;TY_NAT->hi=2147483647LL;TY_POS=tyn(TY_I,Z("POSITIVE"));TY_POS->lo=1;TY_POS->hi=2147483647LL;TY_BOOL=tyn(TY_B,Z("BOOLEAN"));TY_CHAR=tyn(TY_C,Z("CHARACTER"));TY_CHAR->sz=1;TY_STR=tyn(TY_A,Z("STRING"));TY_STR->el=TY_CHAR;TY_FLT=tyn(TY_F,Z("FLOAT"));TY_UINT=tyn(TY_UI,Z("universal_integer"));TY_UFLT=tyn(TY_UF,Z("universal_real"));TY_FILE=tyn(TY_FT,Z("FILE_TYPE"));sya(SM,syn(Z("INTEGER"),1,TY_INT,0));sya(SM,syn(Z("NATURAL"),1,TY_NAT,0));sya(SM,syn(Z("POSITIVE"),1,TY_POS,0));sya(SM,syn(Z("BOOLEAN"),1,TY_BOOL,0));Sy*st=sya(SM,syn(Z("TRUE"),2,TY_BOOL,0));st->vl=1;sv(&TY_BOOL->ev,st);Sy*sf=sya(SM,syn(Z("FALSE"),2,TY_BOOL,0));sf->vl=0;sv(&TY_BOOL->ev,sf);sya(SM,syn(Z("CHARACTER"),1,TY_CHAR,0));sya(SM,syn(Z("STRING"),1,TY_STR,0));sya(SM,syn(Z("FLOAT"),1,TY_FLT,0));sya(SM,syn(Z("FILE_TYPE"),1,TY_FILE,0));sya(SM,syn(Z("CONSTRAINT_ERROR"),3,0,0));sya(SM,syn(Z("PROGRAM_ERROR"),3,0,0));sya(SM,syn(Z("STORAGE_ERROR"),3,0,0));sya(SM,syn(Z("TASKING_ERROR"),3,0,0));fv(&SM->io,stdin);fv(&SM->io,stdout);fv(&SM->io,stderr);SM->fn=3;}
static void fty(Sm*SM,Ty*t,L l){if(!t||t->frz)return;if(t->k==TY_PT&&t->prt&&!t->prt->frz)return;t->frz=1;t->fzn=ND(ERR,l);if(t->bs&&!t->bs->frz)fty(SM,t->bs,l);if(t->prt&&!t->prt->frz)fty(SM,t->prt,l);if(t->el&&!t->el->frz)fty(SM,t->el,l);if(t->k==TY_R)for(uint32_t i=0;i<t->cm.n;i++)if(t->cm.d[i]->sy&&t->cm.d[i]->sy->ty)fty(SM,t->cm.d[i]->sy->ty,l);}
static void fsy(Sm*SM,Sy*s,L l){if(!s||s->frz)return;s->frz=1;s->fzn=ND(ERR,l);if(s->ty&&!s->ty->frz)fty(SM,s->ty,l);}
static void fal(Sm*SM,L l){for(int i=0;i<4096;i++)for(Sy*s=SM->sy[i];s;s=s->nx)if(s->sc==SM->sc&&!s->frz){if(s->ty&&s->ty->k==TY_PT&&s->ty->prt&&!s->prt->frz)continue;if(s->ty)fty(SM,s->ty,l);fsy(SM,s,l);}}
static void scp(Sm*SM){SM->sc++;SM->ss++;}
static void fty(Sm*SM,Ty*t,L l);static void fsy(Sm*SM,Sy*s,L l);static void fal(Sm*SM,L l);
