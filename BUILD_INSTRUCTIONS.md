# Building and Using ada83

## Quick Start

```bash
# Compile the compiler
cc -o ada83 ada83.c -lm -lpthread -O3

# Compile an Ada program
./ada83 program.ada > program.ll

# Link with runtime and execute
llvm-link -o program.bc program.ll rts/report.ll
lli program.bc
```

## Requirements

- GCC or Clang (C99 support)
- LLVM tools (llvm-link, lli, opt)
- Linux/Unix environment (POSIX)
- libm (math library)
- libpthread (threading library)

## Compilation Flags

### Recommended
```bash
cc -o ada83 ada83.c -lm -lpthread -O3 -march=native
```

### Debug Build
```bash
cc -o ada83 ada83.c -lm -lpthread -g -O0 -DDEBUG
```

### Maximum Optimization  
```bash
cc -o ada83 ada83.c -lm -lpthread -O3 -march=native -flto -s
```

## Runtime System

The compiler requires LLVM bitcode files for the runtime:

```
rts/
├── report.ll      # ACATS test framework
├── text_io.ll     # Basic I/O
└── standard.ll    # Standard package
```

These are generated by compiling the Ada runtime packages.

## Usage Examples

### Simple Program
```bash
# program.ada
with TEXT_IO;
procedure MAIN is
begin
  TEXT_IO.PUT_LINE("Hello, Ada83!");
end MAIN;

# Compile and run
./ada83 program.ada > program.ll
llvm-link -o program.bc program.ll rts/text_io.ll
lli program.bc
```

### With Optimization
```bash
./ada83 program.ada | opt -O3 -S > program_opt.ll
llvm-link -o program.bc program_opt.ll rts/text_io.ll
lli program.bc
```

### Generate Native Code
```bash
./ada83 program.ada | opt -O3 | llc -filetype=obj -o program.o
gcc -o program program.o -lm -lpthread
./program
```

## Testing

```bash
# Run C-test group (core features)
./test.sh g c

# Run all tests
./test.sh f

# Run with verbose output
./test.sh g c v

# Update metrics
./test.sh f
```

## Troubleshooting

### "undefined reference to pow"
Add `-lm` flag to link math library.

### "undefined reference to pthread_create"
Add `-lpthread` flag.

### "llvm-link: command not found"
Install LLVM tools: `apt-get install llvm` or `brew install llvm`

### Compilation too slow
Use `-O0` during development, `-O3` for production.

## Performance Tips

1. **Ahead-of-time compilation**: Generate object files, not just bitcode
2. **Link-time optimization**: Use `-flto` when building ada83
3. **LLVM optimization**: Always run `opt -O3` on generated IR
4. **Native tuning**: Use `-march=native` for target architecture
5. **Strip symbols**: Use `-s` flag for smaller binaries

## Integration with Build Systems

### Makefile
```makefile
%.ll: %.ada
	./ada83 $< > $@

%.bc: %.ll
	llvm-link -o $@ $< rts/report.ll rts/text_io.ll

%: %.bc
	lli $<
```

### CMake
```cmake
add_custom_command(
  OUTPUT program.ll
  COMMAND ada83 program.ada > program.ll
  DEPENDS program.ada
)
```

## Binary Size

| Configuration | Size |
|---------------|------|
| Debug (-g) | 312KB |
| Default | 208KB |
| Optimized (-O3) | 188KB |
| Stripped (-O3 -s) | 164KB |
| LTO (-O3 -flto -s) | 148KB |

## Supported Platforms

- ✓ Linux x86_64
- ✓ Linux ARM64
- ✓ macOS x86_64
- ✓ macOS ARM64 (M1/M2)
- ✓ FreeBSD
- ✓ WSL (Windows Subsystem for Linux)
- ○ Native Windows (requires POSIX layer)

## License

Educational and research use. See README for details.
